var crud = require('CrudFile');


exports.remote = function() {
	console.log('Start');
	var json = JSON.parse(this.responseText);

	var win = Ti.UI.createWindow({
		top: 45,
		height : Ti.UI.setHeight,
		width : Ti.UI.setWidth
	});

	var picTabard = Ti.UI.createImageView({
		height : Ti.UI.setHeight,
		width : Ti.UI.setWidth,
		image : 'guild_tabard.png'
	});

	var characterScroll = Ti.UI.createScrollView({
		layout : 'vertical',
		// top: 45,
		height : Ti.UI.setHeight,
		width : Ti.UI.setWidth,
		showVerticalScrollIndicator : true
	});

	wowListTemplate = {
		properties : 
		{
			height : 60
		},
		childTemplates : 
		[
			{
				type : "Ti.UI.Label",
				bindId : 'name',
				properties : 
				{
					color : "black",
					font : 
					{
						fontSize : 18,
						fontFamily : "Arial",
						fontWeight : "bold"
					},
					left : 20,
					top : 5
				}
			}, 
			{
				type : "Ti.UI.Label",
				bindId : 'division',
				properties : 
				{
					color : "black",
					font : 
					{
						fontSize : 14,
						fontFamily : "Arial"
					},
					right : 25,
					top : 10
				},
			}, 
			{
				type : "Ti.UI.Label",
				bindId : 'level',
				properties : 
				{
					color : "grey",
					font : 
					{
						fontSize : 14,
						fontFamily : "Arial"
					},
					left : 20,
					top : 40
				}
			}, 
			{
				type : "Ti.UI.Label",
				bindId : 'acheive',
				properties : 
				{
					color : "black",
					font : 
					{
						fontSize : 14,
						fontFamily : "Arial"
					},
					right : 125,
					top : 40
				},
			}
		]
	};

// var searchbar = Ti.UI.createSearchBar({
	// top : 20,
	// hintText : 'Search',
	// barColor : '#000080',
	// showCancel : false 
// });

	//API Object Info
	var secList = Ti.UI.createListSection({
		item: id
	});
	var apiListView = Ti.UI.createListView({
		top : 20,
		// search : searchbar,
		// hideSearchOnSelection : true,
		opacity : .8,
		templates : {
			'defaultTemplate' : wowListTemplate
		},
		defaultItemTemplate : 'defaultTemplate'
	});
		
	var data = [];	
	
	for (var i = 0; i < json.members.length; i++) {
		name = json.members[i].character.name;
		division = json.members[i].character['class'];
		level = json.members[i].character.level;
		acheive = json.members[i].character.achievementPoints;

		switch (division) {
			case 1:
				division = 'Warrior';
				break;
			case 2:
				division = 'Paladin';
				break;
			case 3:
				division = 'Hunter';
				break;
			case 4:
				division = 'Rogue';
				break;
			case 5:
				division = 'Priest';
				break;
			case 6:
				division = 'Death Knight';
				break;
			case 7:
				division = 'Shaman';
				break;
			case 8:
				division = 'Mage';
				break;
			case 9:
				division = 'Warlock';
				break;
			case 10:
				division = 'Monk';
				break;
			case 11:
				division = 'Druid';
				break;
			default:
				division = 'Null';
				break;
		}
		
		data.push({
			properties : 
			{
				name : name,
				level : level,
				acheive : acheive,
				division : division
			},
			name : 
			{
				text : name
			},
			level : 
			{
				text : 'LVL: ' + level
			},
			acheive : 
			{
				text : 'Points: ' + acheive
			},
			division : 
			{
				text : division
			}
		});
	};

	apiListView.addEventListener('itemclick', function() {
		var mWin = Ti.UI.createWindow({
			title : name,
			backgroundColor : '#fff'
		});
		
		var nameView = Ti.UI.createLabel({
			top: '75dp',
		    left: 35,
			text: 'Name: ' + name
		});
		
		var lvlView = Ti.UI.createLabel({
		    top:'175dp',
		    left: 35,
			text: 'Level: ' + level
		});
		
		var achView = Ti.UI.createLabel({
		    top:'125dp',
		    left: 35,
			text: 'Acheivment Points: ' + acheive
		});
		
		var divView = Ti.UI.createLabel({
		    top:'225dp',
		    left: 35,
			text: 'Class: ' + division
		});	
		
		// Ti.API.info('Save Begin');
		var saveDia = Ti.UI.createAlertDialog({
			title : 'Save Member?',
			buttonNames : ['Cancel', 'Save']
		});
		saveDia.addEventListener('click', function(c) {
			if (c.index === 1) {
				crud.savefunc();
				alert(name + ' is Saved');
			} else {
				null;
			}
		});
		saveDia.show();
	});

	secList.setItems(data);
	// secList.setItems(crud.guildData);
	apiListView.sections = [secList];
	characterScroll.add(apiListView);
	win.add(picTabard, characterScroll);
	win.open();
	console.log('End');
};