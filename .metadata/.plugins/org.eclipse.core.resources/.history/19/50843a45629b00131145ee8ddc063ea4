var curContactWin = Ti.UI.currentWindow();

var navWin = Ti.UI.iOS.createNavigationWindow({
	window : curContactWin
});

var crud = require('CRUD');

var id = a.dataRows.id;

db.execute('SELECT * FROM contact WHERE id=?', id);
	var cancel = Ti.UI.createButton({
		systemButton:Ti.UI.iPhone.SystemButton.CANCEL
	});
	curContactWin.setLeftNavButton(cancel);
	
		cancel.addEventListener('click', function(){
			navWin.close();
		});
				
	var editBTN = Ti.UI.createButton({
		systemButton:Ti.UI.iPhone.SystemButton.EDIT
	});
	curContactWin.setRightNavButton(editBTN);
	
		
		editBTN.addEventListener('click', function(){
			
			var editContactWin = Ti.UI.createWindow({
				title: 'Edit Contact Info',
				backgroundColor: '#fff',
				barColor:'#D4D4D4'
				});
			
			var editnav = Ti.UI.iOS.createNavigationWindow({
				window: editContactWin
			});
			
			var fName = Ti.UI.createTextField({
			    top: '75dp',
			    center: 0,    
			    height: 50,
			    width: 250,
			    color: '#000',    
			    hintText: 'Full Name',
			    autocorret: false,
			    // value: '',
			    font:{fontSize:15, fontWeight:'bold', fontFamily:'Helvetica'},
			    borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
			    borderColor: "#000"
			});
			
			var email = Ti.UI.createTextField({
			    top: '133dp',
			    center: 0,    
			    height: 50,
			    width: 250,
			    color: '#000',    
			    hintText: 'Email Address',
			    autocorret: false,
			    // value: '',
			    font:{fontSize:15, fontWeight:'bold', fontFamily:'Helvetica'},
			    borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
			    borderColor: "#000"
			});
			
			var age = Ti.UI.createTextField({
			    top:'190dp',
			    right: 35,
			    height: 50,
			    width: 75,
			    color: '#000',
			    hintText: 'Age',
			    // value: '',	    
			    font:{fontSize:15, fontWeight:'bold', fontFamily:'Helvetica'},
			    borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
			    borderColor: "#000",
			    keyboardType: Ti.UI.KEYBOARD_NUMBER_PAD
			});
			
			var phone = Ti.UI.createTextField({
			    top:'190dp',
			    left: 35,
			    height: 50,
			    width: 145,
			    color: '#000',
			    // value: '',	    
			    hintText: 'Phone Number',
			    font:{fontSize:15, fontWeight:'bold', fontFamily:'Helvetica'},
			    borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
			    borderColor: "#000",
			    keyboardType: Ti.UI.KEYBOARD_PHONE_PAD
			});
			
			
    		var deleteOk = function (){
				var alertDialogPTA = Ti.UI.createAlertDialog({
    				title: 'Are you Sure?',
        			buttonNames: ['Delete', 'Cancel']
    			});	
    				alertDialogPTA.show();    			
    			alertDialogPTA.addEventListener('click', function(a){
    				if(a.index === 0){
    					db.execute('DELETE FROM contact WHERE id=?', id);
						contactTable.setData(pushData());
						alert('Contact Deleted');
    				} else { 
    					null;
    				}

    			});		
    		};
    	
	    	var deleteBTN = Ti.UI.createButton({
				top : 260,
				center : 0,
				title : "Delete",
				style : Ti.UI.iPhone.SystemButtonStyle.ACTION,
				font : {fontWeight:'bold',fontSize:18, fontFamily:'Helvetica'},
				color : '#EE2C2C'
			});
			deleteBTN.addEventListener('click', deleteOk);			
			
			
			var doneBTN = Ti.UI.createButton({
				systemButton:Ti.UI.iPhone.SystemButton.DONE
			});
			doneBTN.addEventListener('click', function(){
				Ti.API.info('Going through loop');
			
					
					if (fName.value == '' && phone.value == '' && email.value == '') {
						alert('Please Enter Full Name, Phone Number, and eMail');
					} else if (fName.value == '') {
						alert('Please Enter Name');
					} else if (phone.value == '') {
						alert('Please Enter Phone Number');
					} else if (email.value == '') {
						alert('Please Enter Email Address');
					} else {
					
				Ti.API.info('all set');
					
					var editContact = {};
						editContact.fName_add = fName.value;
						editContact.email_add = email.value;
						editContact.age_add = age.value;
						editContact.phone_add = phone.value;
						editContact.id = edit.id;
						
				Ti.API.info('inserting data to table');
					
					db.execute("UPDATE contact SET fname=?, email=?, age=?, phone=? WHERE id=?", editContact.fName_add, editContact.email_add, editContact.age_add, editContact.phone_add, editContact.id);
					
				// Ti.API.info('stringing info');
			// 
					// var contactInfo = escape(JSON.stringify(inputContact));
					
				Ti.API.info('pushing data to table');
					
					contactTable.setData(pushData());
					
				Ti.API.info('keyboard going down');
					
					fName.blur();
					email.blur();
					age.blur();
					phone.blur();
					
				Ti.API.info('clearing values');
					//Clearing Feilds and drop Keyboard
					fName.value = '';
					email.value = '';
					age.value = '';
					phone.value = '';
						
					doneBTN.removeEventListener('click', edit);
						editContactWin.close();
						alert('Contact has been updated!!');
					}

				});
    			//editContactWin Main Code
				editContactWin.add(deleteBTN);		
				editContactWin.setRightNavButton(doneBTN);
				editContactWin.add(fName, email, age, phone);
				editnav.open();
		});
//Main Code
navWin.open();